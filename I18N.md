# Internationalization & Chat Guide

Guide for using translations and integrating chat into your app.

---

## Supported Languages

- ðŸ‡¬ðŸ‡§ English (en)
- ðŸ‡³ðŸ‡± Dutch (nl)
- ðŸ‡ªðŸ‡¸ Spanish (es)
- ðŸ‡«ðŸ‡· French (fr)
- ðŸ‡µðŸ‡¹ Portuguese (pt)

Language is auto-detected from device settings, defaults to English.

---

## Using Translations

### Basic Usage

```typescript
import { t } from '../i18n';

// Simple translation
<Text>{t('home.title')}</Text>
// Output: "Who's The Imposter?"

// With parameters
<Text>{t('game.players', { count: 5 })}</Text>
// Output: "Players (5)"

// Nested keys
<Text>{t('subscription.features.onlineMode')}</Text>
// Output: "Online Multiplayer"
```

### Translation Structure

All translation files follow this structure:

```json
{
  "common": {},      // OK, Cancel, Save, etc.
  "home": {},        // Home screen
  "createLobby": {}, // Create lobby screen
  "joinLobby": {},   // Join lobby screen
  "game": {},        // Game screens
  "results": {},     // Results screen
  "categories": {},  // Category names
  "settings": {},    // Settings
  "subscription": {},// Subscription screen
  "rating": {},      // Rating prompt
  "howToPlay": {},   // How to play
  "errors": {}       // Error messages
}
```

### Translation Files

Located in `src/i18n/locales/`:
- `en.json` - English (master)
- `nl.json` - Dutch
- `es.json` - Spanish
- `fr.json` - French
- `pt.json` - Portuguese

---

## Adding New Translations

### Step 1: Add to English

Edit `src/i18n/locales/en.json`:

```json
{
  "newFeature": {
    "title": "New Feature",
    "description": "This is a new feature",
    "button": "Try it now"
  }
}
```

### Step 2: Translate to Other Languages

**Dutch (nl.json):**
```json
{
  "newFeature": {
    "title": "Nieuwe Functie",
    "description": "Dit is een nieuwe functie",
    "button": "Probeer het nu"
  }
}
```

**Spanish (es.json):**
```json
{
  "newFeature": {
    "title": "Nueva FunciÃ³n",
    "description": "Esta es una nueva funciÃ³n",
    "button": "PruÃ©balo ahora"
  }
}
```

Repeat for French and Portuguese.

### Step 3: Use in Code

```typescript
import { t } from '../i18n';

<View>
  <Text>{t('newFeature.title')}</Text>
  <Text>{t('newFeature.description')}</Text>
  <Button title={t('newFeature.button')} />
</View>
```

---

## Language Management

### Get Current Language

```typescript
import { getCurrentLanguage } from '../i18n';

const lang = getCurrentLanguage(); // "en", "nl", etc.
```

### Change Language

```typescript
import { setLanguage } from '../i18n';

await setLanguage('es'); // Switch to Spanish
```

### Get Available Languages

```typescript
import { getAvailableLanguages } from '../i18n';

const languages = getAvailableLanguages();
// [
//   { code: 'en', name: 'English', flag: 'ðŸ‡¬ðŸ‡§' },
//   { code: 'nl', name: 'Nederlands', flag: 'ðŸ‡³ðŸ‡±' },
//   { code: 'es', name: 'EspaÃ±ol', flag: 'ðŸ‡ªðŸ‡¸' },
//   { code: 'fr', name: 'FranÃ§ais', flag: 'ðŸ‡«ðŸ‡·' },
//   { code: 'pt', name: 'PortuguÃªs', flag: 'ðŸ‡µðŸ‡¹' }
// ]
```

---

## Updating Existing Screens

### Before
```typescript
<Text>Create Lobby</Text>
<Button title="Start Game" />
<Text>{playerCount} players</Text>
```

### After
```typescript
import { t } from '../i18n';

<Text>{t('createLobby.title')}</Text>
<Button title={t('createLobby.startGame')} />
<Text>{t('game.players', { count: playerCount })}</Text>
```

---

## In-Game Chat Integration

### Overview

Real-time chat for online games with:
- Player names and timestamps
- Auto-scroll to new messages
- Different styling for own messages
- 200 character limit
- Keyboard handling

### Integration Steps

**1. Import Chat Component**

```typescript
import { Chat } from '../components';
```

**2. Add State for Messages**

```typescript
import { ChatMessage } from '../types';

const [chatMessages, setChatMessages] = useState<ChatMessage[]>([]);
```

**3. Listen for Chat Messages**

```typescript
import { WS_MESSAGE_TYPES } from '../constants';

useEffect(() => {
  const unsubscribe = websocketService.on(
    WS_MESSAGE_TYPES.CHAT_MESSAGE,
    (data: ChatMessage) => {
      setChatMessages(prev => [...prev, data]);
    }
  );

  return unsubscribe;
}, []);
```

**4. Handle Sending Messages**

```typescript
const handleSendMessage = (message: string) => {
  if (!playerName) return;
  websocketService.sendChatMessage(playerName, message);
};
```

**5. Render Chat Component**

```typescript
<Chat
  messages={chatMessages}
  onSendMessage={handleSendMessage}
  currentPlayerId={playerId}
/>
```

### Complete Example (OnlineGameScreen)

```typescript
import React, { useState, useEffect } from 'react';
import { View } from 'react-native';
import { Chat } from '../components';
import { websocketService } from '../services/websocket';
import { WS_MESSAGE_TYPES } from '../constants';
import { ChatMessage } from '../types';

export function OnlineGameScreen() {
  const [chatMessages, setChatMessages] = useState<ChatMessage[]>([]);
  const [playerName, setPlayerName] = useState('');
  const [playerId, setPlayerId] = useState('');
  const [lobby, setLobby] = useState(null);

  // Listen for chat messages
  useEffect(() => {
    const unsubscribe = websocketService.on(
      WS_MESSAGE_TYPES.CHAT_MESSAGE,
      (data: ChatMessage) => {
        setChatMessages(prev => [...prev, data]);
      }
    );

    return unsubscribe;
  }, []);

  const handleSendMessage = (message: string) => {
    if (!playerName) return;
    websocketService.sendChatMessage(playerName, message);
  };

  return (
    <View style={{ flex: 1 }}>
      {/* Game content */}

      {/* Show chat during discussion phase */}
      {lobby?.phase === 'discussion' && (
        <Chat
          messages={chatMessages}
          onSendMessage={handleSendMessage}
          currentPlayerId={playerId}
        />
      )}
    </View>
  );
}
```

### When to Show Chat

**Recommended:**
- **Discussion Phase** - Main use case
- **Waiting Room** - Before game starts (optional)

**Not Recommended:**
- Revealing Phase - Players should focus
- Results Phase - Game is over

### Chat Customization

**Change message limit:**
```typescript
// In Chat.tsx component
<TextInput
  maxLength={500} // Change from 200
  {...props}
/>
```

**Conditional chat display:**
```typescript
{lobby?.phase === 'discussion' && (
  <Chat messages={chatMessages} onSendMessage={handleSendMessage} />
)}
```

**Toggle chat visibility:**
```typescript
const [showChat, setShowChat] = useState(true);

<Button onPress={() => setShowChat(!showChat)}>
  {t(showChat ? 'chat.hide' : 'chat.show')}
</Button>

{showChat && <Chat {...props} />}
```

---

## Testing

### Testing Translations

1. **Test auto-detection:**
   - Change device language
   - Restart app
   - Verify correct language loads

2. **Test manual switching:**
   - Open Settings
   - Change language
   - Verify app refreshes with new language

3. **Check all screens:**
   - Navigate through all screens
   - Verify no missing translations
   - Check text fits in UI

### Testing Chat

1. **Test sending:**
   - Send message from one device
   - Verify appears on all devices
   - Check timestamp is correct

2. **Test UI:**
   - Own messages on right
   - Others' messages on left
   - Auto-scrolls to bottom
   - Keyboard doesn't cover input

3. **Test edge cases:**
   - Long messages (200 char limit)
   - Rapid messages
   - Emoji support
   - Special characters

---

## Common Issues

### Translations Not Showing

**Problem:** Text appears as keys (e.g., "home.title")

**Solutions:**
1. Check import: `import { t } from '../i18n';`
2. Verify key exists in all JSON files
3. Clear cache: `npm start -- --clear`
4. Rebuild app

### Chat Messages Not Sending

**Problem:** Messages don't appear

**Solutions:**
1. Check WebSocket connection is active
2. Verify server is running
3. Check player name is set
4. Check console for errors
5. Verify `WS_MESSAGE_TYPES.CHAT_MESSAGE` matches server

### Wrong Language Displayed

**Problem:** App shows wrong language

**Solutions:**
1. Check device language settings
2. Clear app data and reinstall
3. Verify locale files are included in build
4. Check `getCurrentLanguage()` returns correct code

---

## Translation Tips

### Keep Keys Consistent
```json
// Good
{
  "button": {
    "save": "Save",
    "cancel": "Cancel",
    "delete": "Delete"
  }
}

// Bad - inconsistent nesting
{
  "saveButton": "Save",
  "button": {
    "cancel": "Cancel"
  }
}
```

### Use Parameters for Dynamic Content
```typescript
// Good
t('game.players', { count: 5 })

// Bad - hardcoded
`${count} players`
```

### Handle Plurals Properly
```json
{
  "game": {
    "players": "{{count}} player(s)",
    "playersOne": "{{count}} player",
    "playersOther": "{{count}} players"
  }
}
```

### Keep Translations Short
Some languages are longer than English. Leave space in UI.

**Example:**
- English: "Play"
- German: "Spielen"
- Portuguese: "Jogar agora"

---

## Quick Reference

### Import Translation Function
```typescript
import { t } from '../i18n';
```

### Use Translation
```typescript
{t('key.path')}
{t('key.path', { param: value })}
```

### Change Language
```typescript
import { setLanguage } from '../i18n';
await setLanguage('es');
```

### Add Chat to Screen
```typescript
import { Chat } from '../components';

<Chat
  messages={chatMessages}
  onSendMessage={handleSendMessage}
  currentPlayerId={playerId}
/>
```

### Send Chat Message
```typescript
websocketService.sendChatMessage(playerName, message);
```

### Listen for Chat Messages
```typescript
websocketService.on(WS_MESSAGE_TYPES.CHAT_MESSAGE, (data) => {
  setChatMessages(prev => [...prev, data]);
});
```
